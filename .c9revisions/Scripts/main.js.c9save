{"ts":1343275528650,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"window.onload = function() {\n    function cloneBit(obj) {\n        if (null == obj || \"object\" != typeof obj) return obj;\n        //var copy = obj.constructor();\n        var copy = new Bitmap();\n        for (var attr in obj) {\n            if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\n        }\n        return copy;\n    }\n    \n    var ship2plan = 20;\n    var menuDiv = $(\"#menu\");\n    var canvas = $(\"#c\");\n    //console.log(canvas);\n    var splash = $(\"#splash\");\n    var otherMenu = $(\"#otherMenu\");\n    var touchCons = $(\"#touchControls\");\n    var map = $(\"#map\");\n    var mapC = $(\"#mapCanv\");\n    var mapStage = new Stage(mapC[0]);\n    var stage = new Stage(canvas[0]);\n    var three = false;\n    var speakingOpts = {pitch: 150};\n    var curRing = 1;\n    var maxRings = 9;\n    \n    var imgs = {\n        playerShip: \"Graphics/starship.svg\",\n        enemyShip: \"Graphics/starshipdark_flipped.svg\",\n        speaker: \"Graphics/Icons/speaker.svg\",\n        muted: \"Graphics/Icons/speaker_muted.svg\",\n        pause: \"Graphics/Icons/stop_hand.svg\",\n        play: \"Graphics/Icons/right_arrow.svg\",\n        stars: \"Graphics/space.svg\"\n    };\n    //alert(Modernizr.svg);\n    if(!Modernizr.svg || three) {\n        imgs.playerShip = \"Graphics/starship.png\";\n        imgs.enemyShip = \"Graphics/starshipdark_flipped.png\";\n        imgs.stars = \"Graphics/space.png\";\n    }\n    \n    function blank() {}\n    \n    /*if(screen.width<640 || screen.height<480) {\n        canvas[0].width = 320;\n        canvas[0].height = 240;\n        /*canvas.click(function() {\n            f = !f;\n        });\n    } else if(screen.width>=960 && screen.height>=720) {\n        canvas[0].width = 960;\n        canvas[0].height = 720;\n    }*/\n    /*if(screen.width>screen.height) {\n        canvas[0].height = screen.height-10;\n        canvas[0].width = screen.height-10;\n    } else {\n        canvas[0].width = screen.width-10;\n        canvas[0].height = screen.width-10;\n    }*/\n    canvas[0].width = screen.width;\n    canvas[0].height = screen.height;\n    \n    mapC[0].width = canvas[0].height-25;\n    mapC[0].height = canvas[0].height-25;\n    var shipW = (64/640)*canvas[0].width;\n    \n    var cbs = {\n        playerShip: blank,\n        enemyShip: blank,\n        speaker: blank,\n        muted: blank,\n        pause: blank,\n        play: blank,\n        stars: function() {\n            if(!Modernizr.svg || three) {\n                //console.log(imgs, imgs.stars);\n                canvas.css(\"background-image\", \"url(\"+imgs.stars+\")\");\n            }\n        }\n    };\n    \n    function make3D() {\n        for(var i in imgs) {\n            var a = new Image();\n            a.i = i;\n            a.onload = function() {\n                imgs[this.i] = threed(this);\n                cbs[this.i].call();\n                //window.open(imgs[this.i]);\n            };\n            a.src = imgs[i];\n        }\n        //console.log(imgs);\n        //window.open(imgs.playerShip);\n        /*var i = 0;\n        var nxtImg = function(e) {\n            i += 1;\n            console.log(i);\n            if(i>=imgs.length) {\n                alert(\"Bazinga!\");\n                cb();\n            } else {\n                a = new Image();\n                a.onload = nxtImg;\n                a.src = imgs[i];\n            }\n        };\n        var a = new Image();\n        a.onload = nxtImg;\n        a.src = imgs[i];*/\n    }\n    if(three) {\n        $(\"#3dstyle\").attr(\"rel\", \"stylesheet\");\n        make3D();\n    }\n    \n    //var shootInt = 0;\n    Array.prototype.findIndex = function(val) {\n        for(var i in this) {\n            if(this[i] == val) {\n                return i;\n            }\n        }\n        return false;\n    };\n    Array.prototype.removeIt = function(val) {\n        var s = this.findIndex(val);\n        if(s!==false) {\n            this.splice(s,1);\n        }\n    };\n    /*function replacementImg(src) {\n        var canvgC = document.createElement(\"canvas\");\n        canvg(canvgC, src);\n        return canvgC.toDataURL(\"image/png\");\n    }*/\n    \n    function E(a, b) {\n        if(a && b) {\n            return !(\n                ((a.y + a.height) < (b.y)) ||\n                (a.y > (b.y + b.height)) ||\n                ((a.x + a.width) < b.x) ||\n                (a.x > (b.x + b.width))\n            );\n        } else {\n            return false;\n        }\n    }\n    \n    function Planet(name, src, x, y) {\n        this.name = name;\n        this.src = src;\n        this.x = x;\n        this.y = y;\n        this.r = ship2plan*shipW;\n        var t = this;\n        this.img = new Image();\n        this.img.onload = function() {\n            t.bit = new Bitmap(this);\n            //t.bit.x = t.x;\n            //t.bit.y = t.y;\n            //console.log(t, t.r, this.width);\n            t.bit.scaleX = t.r*2/this.width;\n            t.bit.scaleY = t.r*2/this.height;\n            //stage.addChild(t.bit);\n            //stage.update();\n        };\n        this.img.src = this.src;\n    }\n    var planets = [new Planet(\"Zaklorg\", \"http://opengameart.org/sites/default/files/PlanetRed.png\", 0, 0), new Planet(\"Vlag\", \"Graphics/tundra.png\", 5, 3), new Planet(\"Shukal\", \"Graphics/desert.png\", 9, 9)];\n    var magicPlanet = new Planet(\"Yil-Tulzscha\", \"http://placekitten.com/1024/1024\", 0, 0);\n    //var curPlanet = planets[0];\n    \n    var playerBullets = [];\n    var enemyBullets = [];\n    window.enemies = [];\n    \n    function Bullet(colors,x,y,type) {\n        this.colors = colors;\n        this.x = x;\n        this.y = y;\n        //this.w = 8;\n        this.w = (8/640)*canvas[0].width;\n        //this.h = 12;\n        this.h = (12/640)*canvas[0].width;\n        this.power = 2;\n        this.width = this.w;\n        this.height = this.h;\n        this.type = type;\n        this.g = new Graphics();\n        //this.g.beginFill(color);\n        //this.g.drawRoundRect(0,0,8,8,4,4);\n        //this.g.beginLinearGradientFill([\"green\", \"lime\", \"green\"], [0, 0.5, 1], 0, 0, 8, 0);\n        this.g.beginLinearGradientFill(this.colors, [0, 0.5, 1], 0, 0, this.w, 0);\n        this.g.drawRect(0,0,this.w,this.h);\n        this.rect = new Shape(this.g);\n        this.rect.x = this.x;\n        this.rect.y = this.y;\n        if(this.type==\"friend\") {\n            //this.spd = -9;\n            this.spd = (-9/640)*canvas[0].width;\n        } else if(this.type==\"enemy\") {\n            //this.spd = 9;\n            this.spd = (9/640)*canvas[0].width;\n        }\n        stage.addChild(this.rect);\n    }\n    Bullet.prototype.update = function() {\n        //this.y -= 9;\n        this.y += this.spd;\n        this.rect.y = this.y;\n        if(this.type == \"friend\" && this.y<-this.h) {\n            //console.log(\"badoom\");\n            playerBullets.removeIt(this);\n        } else if(this.type==\"enemy\" && this.y>canvas[0].height) {\n            enemyBullets.removeIt(this);\n        }\n    };\n    \n    function EnemyShip(imgSrc,x,y,width,height) {\n        this.imgSrc = imgSrc;\n        this.x = x;\n        //this.y = y;\n        this.y = 0-height;\n        this.maxY = y;\n        //this.spd = 2;\n        this.spd = (2/640)*canvas[0].width;\n        this.width = width;\n        this.height = height;\n        this.bit = {x:0,y:0};\n        this.bulletInt = 800;\n        this.shootInt = 800;\n        //this.shootInt = 500;\n        this.baseHealth = 50;\n        this.health = 50;\n        this.maxHealth = 50;\n        this.maxHealth += ((curRing-1)/(maxRings-1));\n        this.health += ((curRing-1)/(maxRings-1));\n        \n        this.img = new Image();\n        var t = this;\n        this.img.onload = function() {\n            t.bit = new Bitmap(this);\n            //t.bit.regX = this.width/2;\n            //t.bit.regY = this.height/2;\n            //t.bit.rotation = 180;\n            t.bit.x = t.x;\n            t.bit.y = t.y;\n            t.bit.scaleX = t.width/this.width;\n            t.bit.scaleY = t.height/this.height;\n            //console.log(t.bit);\n            stage.addChild(t.bit);\n            stage.update();\n        };\n        this.img.src = this.imgSrc;\n    }\n    EnemyShip.prototype.update = function(p) {\n        var vx = 0;\n        //var vy = 0;\n        //if(this.x) vy -= this.spd;\n        //if(d) vy += this.spd;\n        //console.log(p);\n        if(this.x>p.x) vx -= this.spd;\n        if(this.x<p.x) vx += this.spd;\n        if(this.x==p.x) vx = 0;\n        this.x += vx;\n        if(this.y<this.maxY) {\n            this.y += this.spd;\n        }\n        /*if(this.x>canvas.width()-this.width || this.x<0) {\n            this.x -= vx;\n        }\n        this.y += vy;\n        if(this.y>canvas.height()-this.height || this.y<0) {\n            this.y -= vy;\n        }\n        this.bit.x = this.x;\n        this.bit.y = this.y;\n        \n        if(f && shootInt>=this.bulletInt) {\n            playerBullets.push(new Bullet([\"green\", \"lime\", \"green\"], this.x+this.width/2-4, this.y-4, \"friend\"));\n            shootInt = 0;\n        }*/\n        if(this.shootInt>=this.bulletInt) {\n            enemyBullets.push(new Bullet([\"red\", \"orange\", \"red\"], this.x+this.width/2-4, this.y+this.height, \"enemy\"));\n            var sound = soundManager.getSoundById(\"Bullet\");\n            sound.setPosition(0);\n            sound.play();\n            //soundManager.play(\"Bullet\");\n            this.shootInt = 0;\n        }\n        this.bit.x = this.x;\n        this.bit.y = this.y;\n    };\n    \n    function PlayerShip(imgSrc,x,y,width,height, health, maxHealth) {\n        this.imgSrc = imgSrc;\n        this.x = x;\n        this.y = y;\n        //this.spd = 3;\n        this.spd = (3/640)*canvas[0].width;\n        this.spdOrig = (3/640)*canvas[0].width;\n        this.width = width;\n        this.height = height;\n        this.bit = {x:0,y:0};\n        this.bulletInt = 500;\n        this.shootInt = 0;\n        this.health = health||100;\n        this.maxHealth = maxHealth||100;\n        \n        /*this.g = new Graphics();\n        //this.g.beginFill(color);\n        //this.g.drawRoundRect(0,0,8,8,4,4);\n        //this.g.beginLinearGradientFill([\"green\", \"lime\", \"green\"], [0, 0.5, 1], 0, 0, 8, 0);\n        this.g.beginLinearGradientFill(this.colors, [0, 0.5, 1], 0, 0, this.w, 0);\n        this.g.drawRect(0,0,this.w,this.h);\n        this.rect = new Shape(this.g);\n        this.rect.x = this.x;\n        this.rect.y = this.y;*/\n        \n        this.healthBar = {\n            g: new Graphics()\n        }\n        this.healthBar.g.beginFill(\"green\");\n        this.healthBar.g.drawRect(0,0,this.width,5);\n        this.healthBar.rect = new Shape(this.healthBar.g);\n        this.healthBar.rect.x = this.x;\n        //alert(this.y);\n        //alert(this.h);\n        this.healthBar.rect.y = this.y+this.height;\n        stage.addChild(this.healthBar.rect);\n        //console.log(this.healthBar.rect);\n        \n        this.img = new Image();\n        var t = this;\n        this.img.onload = function() {\n            t.bit.regX = 0;\n            t.bit = new Bitmap(this);\n            t.bit.x = t.x;\n            t.bit.y = t.y;\n            t.bit.scaleX = t.width/this.width;\n            t.bit.scaleY = t.height/this.height;\n            //console.log(t.bit);\n            stage.addChild(t.bit);\n            stage.update();\n        };\n        this.img.src = this.imgSrc;\n    }\n    PlayerShip.prototype.update = function(u,d,l,r,f) {\n        var vx = 0;\n        var vy = 0;\n        if(u) vy -= this.spd;\n        if(d) vy += this.spd;\n        if(l) vx -= this.spd;\n        if(r) vx += this.spd;\n        this.x += vx;\n        if(this.x>canvas[0].width-this.width || this.x<0) {\n            this.x -= vx;\n        }\n        this.y += vy;\n        if(this.y>canvas[0].height-this.height || this.y<0) {\n            this.y -= vy;\n        }\n        this.bit.x = this.x;\n        this.bit.y = this.y;\n        \n        this.healthBar.g.clear();\n        //this.healthBar.g = new Graphics();\n        this.healthBar.g.beginFill(\"green\");\n        this.healthBar.g.drawRect(0, 0, (this.health/this.maxHealth)*this.width, 5);\n        //this.healthBar.rect = new Shape(this.healthBar.g);\n        //this.healthBar.rect.x = this.x;\n        \n        this.healthBar.rect.x = this.x;\n        this.healthBar.rect.y = this.y+this.height;\n        //console.log(this.healthBar);\n        \n        if(f && this.shootInt>=this.bulletInt) {\n            //soundManager.play(\"Bullet\");\n            playerBullets.push(new Bullet([\"green\", \"lime\", \"green\"], this.x+this.width/2-4, this.y-4, \"friend\"));\n            var sound = soundManager.getSoundById(\"Bullet\");\n            sound.setPosition(0);\n            sound.play();\n            this.shootInt = 0;\n        }\n        \n        //stage.update();\n    };\n    function pausePlay(){\n        var p = Ticker.getPaused();\n        Ticker.setPaused(!p);\n        clearTimeout(window.enemTimeout);\n        if(p) {\n            window.enemTimeout = setTimeout(function() { fight([new EnemyShip(imgs.enemyShip, canvas[0].width/2-shipW/2, canvas[0].height*0.25-shipW, shipW, shipW)])}, 45000);\n            $(\"#pauseToggle img\").attr(\"src\", imgs.pause);\n        } else {\n            $(\"#pauseToggle img\").attr(\"src\", imgs.play);\n        }\n    }\n    \n    var u,d,l,r,f = false;\n    document.body.onkeydown = function(e) {\n        //console.log(e.which);\n        if(e.which===38 || e.which===87) {\n            u = true;\n        } else if(e.which===40 || e.which===83) {\n            e.preventDefault();\n            d = true;\n        } else if(e.which===39 || e.which===68) {\n            r = true;\n        } else if(e.which===37 || e.which===65) {\n            l = true;\n        } else if(e.which===32) {\n            e.preventDefault()\n            f = true;\n        } else if(e.which===16) {\n            //$(\"#pauseToggle\").click();\n            //alert(\"Pause clicked\")\n            /**var p = Ticker.getPaused();\n            Ticker.setPaused(!p);\n            if(p) {\n                window.enemTimeout = setTimeout(function() { fight([new EnemyShip(imgs.enemyShip, canvas[0].width/2-shipW/2, canvas[0].height*0.25-shipW, shipW, shipW)])}, 45000);\n                $(\"#pauseToggle img\").attr(\"src\", imgs.pause);\n            } else {\n                clearTimeout(window.enemTimeout);\n                $(\"#pauseToggle img\").attr(\"src\", imgs.play);\n            }*/\n            pausePlay()\n        }\n    };\n    document.onkeyup = function(e) {\n        if(e.which===38 || e.which===87) {\n            u = false;\n        } else if(e.which===40 || e.which===83) {\n            d = false;\n        } else if(e.which===39 || e.which===68) {\n            r = false;\n        } else if(e.which===37 || e.which===65) {\n            l = false;\n        } else if(e.which===32) {\n            f = false;\n        } else if(e.which===90) {\n            switchRing(curRing+1);\n        } else if(e.which===88) {\n            switchRing(curRing-1);\n        }\n        //console.log(e.which);\n    };\n    canvas[0].ontouchstart = function() {\n        Ticker.setPaused(!Ticker.getPaused());\n        //soundManager.mute\n    }\n    /*canvas[0].ontouchend = function () {\n        Ticker.setPaused(false);\n    };*/\n    $(\"#up\").live(\"touchstart\", function() {\n        u = true;\n    }).live(\"touchend\", function() {\n        u = false;\n    });\n    $(\"#down\").live(\"touchstart\", function() {\n        d = true;\n    }).live(\"touchend\", function() {\n        d = false;\n    });\n    $(\"#left\").live(\"touchstart\", function() {\n        l = true;\n    }).live(\"touchend\", function() {\n        l = false;\n    });\n    $(\"#right\").live(\"touchstart\", function() {\n        r = true;\n    }).live(\"touchend\", function() {\n        r = false;\n    });\n    $(\"#fire\").live(\"touchstart\", function() {\n        f = true;\n    }).live(\"touchend\", function() {\n        f = false;\n    });\n    \n    var bgInc = (20/640)*canvas[0].width/1.75;\n    var bgIncOrig = (20/640)*canvas[0].width;\n    var ratio = 21/shipW;\n    //var distInc = ratio*bgInc;\n    //var distTravel = 0;\n    window.tick = function() {\n        //console.log(\"tick\");\n        //canvas[0].style.backgroundPositionY = parseInt(canvas[0].style.backgroundPositionY||0, 10)+bgInc+\"px\";\n        var curBGPos = parseInt(canvas[0].style.backgroundPosition.split(\" \")[1]||0, 10);\n        //canvas[0].style.backgroundPosition = \"0px \"+Math.round((parseInt(canvas[0].style.backgroundPosition.split(\" \")[1]||0, 10)+bgInc)/1.1)+\"px, 50px \"+(parseInt(canvas[0].style.backgroundPosition.split(\" \")[1]||0, 10)+bgInc)/2+\"px, 1000px \"+(parseInt(canvas[0].style.backgroundPosition.split(\" \")[1]||0, 10)+bgInc)/4+\"px\";\n        canvas[0].style.backgroundPosition = \"0px \"+(curBGPos+bgInc/2)+\"px, 50px \"+(curBGPos+bgInc)/2+\"px, 100px \"+(curBGPos+bgInc)/4+\"px\";\n        //console.log((curBGPos+bgInc)/2);\n        //console.log(parseInt(canvas[0].style.backgroundPosition.split(\" \")[1]||0, 10)+bgInc)\n        \n        //console.log(\"0px \"+(parseInt(canvas[0].style.backgroundPosition.split(\" \")[1], 10)+20)+\"px\");\n        \n        window.playerShip.update(u,d,l,r,f);\n        if(window.to && window.from) {\n            window.from.bit.y += window.playerShip.spd;\n            window.to.bit.y += window.playerShip.spd;\n            /*window.from.bit.y += bgInc;\n            window.to.bit.y += bgInc;*/\n            //console.log(window.to.bit.y);\n            if(E(window.playerShip, window.to.bit)) {\n                window.curPlanet = window.to;\n                //console.log(curPlanet);\n                //window.to = null;\n                window.from = null;\n                playerBullets = [];\n                stage.removeAllChildren();\n                stage.update();\n                Ticker.setPaused(true);\n                menuScreen();\n            }\n            //stage.update();\n        }\n        for(var i=0;i<playerBullets.length;i++) {\n            playerBullets[i].update();\n        }\n        //console.log(playerBullets);\n        for(var j=0;j<enemies.length;j++) {\n            enemies[j].update(window.playerShip);\n            //enemies[j].shootInt += 1000/Ticker.getFPS();\n            enemies[j].shootInt += 1000/30;\n            \n            for(var m=0;m<playerBullets.length;m++) {\n                if(E(enemies[j], playerBullets[m])) {\n                    //console.log(\"A hit, cap'n!\");\n                    enemies[j].health -= playerBullets[m].power;\n                    stage.removeChild(playerBullets[m].rect);\n                    playerBullets.removeIt(playerBullets[m]);\n                }\n            }\n            if(enemies[j].health<=0) {\n                //alert(\"enemy killed\");\n                soundManager.play(\"Explosion\");\n                stage.removeChild(enemies[j].bit);\n                enemies.removeIt(enemies[j]);\n                window.enemTimeout = setTimeout(function() { fight([new EnemyShip(imgs.enemyShip, canvas[0].width/2-shipW/2, canvas[0].height*0.25-shipW, shipW, shipW)])}, 45000);\n                //unfight();\n            }\n        }\n        for(var k=0;k<enemyBullets.length;k++) {\n            enemyBullets[k].update();\n            if(E(window.playerShip, enemyBullets[k])) {\n                //console.log(\"A hit, cap'n!\");\n                window.playerShip.health -= enemyBullets[k].power;\n                stage.removeChild(enemyBullets[k].rect);\n                enemyBullets.removeIt(enemyBullets[k]);\n            }\n        }\n        stage.update();\n        //window.playerShip.shootInt += 1000/Ticker.getFPS();\n        window.playerShip.shootInt += 1000/30;\n        if(window.playerShip.health<=0) {\n            //alert(\"You died!\");\n            soundManager.play(\"Explosion\");\n            Ticker.setPaused(true);\n            menuScreen();\n        }\n        if(enemies.length===0 && fighting) {\n            unfight();\n        }\n        //console.log(shootInt);\n        \n        \n    };\n    \n    //window.scrollTo(0,1);\n    //var canvas = document.getElementById(\"c\");\n    \n    function hideAll() {\n        menuDiv.hide();\n        canvas.hide();\n        splash.hide();\n        otherMenu.hide();\n        touchCons.hide();\n        map.hide();\n    }\n    \n    function mapScreen() {\n        mapStage.mouseEnabled = true;\n        mapStage.enableMouseOver(25);\n        mapStage.removeAllChildren();\n        hideAll();\n        map.show();\n        speak(\"Select your destination.\", speakingOpts);\n        var size = mapC[0].width/10;\n        /*for(var y=0;y<100;y++) {\n            for(var x=0;x<100;x++) {\n                \n            }\n        }*/\n        var g = new Graphics();\n        g.beginFill(\"rgba(0, 0, 255, 0.5)\");\n        g.drawRect(0, 0, size, size);\n        //g.drawCircle(size/2, size/2, size/2);\n        var s = new Shape(g);\n        s.x = window.curPlanet.x*size;\n        s.y = window.curPlanet.y*size;\n        //mapStage.addChild(s);\n        //console.log(s);\n        var img = new Image();\n        img.onload = function() {\n            for(var i=0;i<planets.length;i++) {\n                var b = new Bitmap(this);\n                b.x = planets[i].x*size;\n                b.y = planets[i].y*size;\n                b.planet = planets[i];\n                b.scaleX = b.scaleY = size/this.width;\n                b.y += (size-b.scaleY*this.height)/2;\n                b.onMouseOver = function(e) {\n                    //console.log(this.planet.name);\n                    $(\"#mapDesc b\").text(this.planet.name);\n                }\n                b.onClick = function(e) {\n                    if(this.planet!=window.curPlanet) {\n                        travelTo(window.curPlanet, this.planet);\n                    }\n                }\n                mapStage.addChild(b);\n            }\n            mapStage.addChild(s);\n            mapStage.update();\n        };\n        img.src = \"Graphics/Icons/planet.png\";\n    }\n    function menuScreen() {\n        clearTimeout(window.enemTimeout);\n        document.body.setAttribute(\"class\", \"\");\n        //console.log(1, window.curPlanet);\n        window.curPlanet = window.curPlanet||planets[0];\n        //canvas.hide();\n        $(\"#curPlan\").html(window.curPlanet.name);\n        //menuDiv.hide();\n        //splash.hide();\n        hideAll();\n        soundManager.stopAll();\n        if(!('ontouchstart' in window)) {\n            otherMenu.show();\n        }\n        /*menuDiv.fadeIn(2000, \"easeInElastic\", function() {\n            if(!soundManager.getSoundById(\"Travel\").muted) {\n                //speak(\"Please select your action.\", {pitch: 150});\n                var responses = [\"Please select your action.\", \"What will you do now?\", \"What course will you follow now?\"];\n                speak(\"Welcome to \"+window.curPlanet.name+\". \"+responses[Math.floor(Math.random()*responses.length)], speakingOpts);\n            }\n            //alert(\"Boom\");\n        });*/\n        menuDiv.css(\"opacity\", \"0\");\n        menuDiv.show();\n        menuDiv.animate({opacity: 1}, {easing: \"ease-in\", duration: 2000, complete: function() {\n            if(!soundManager.getSoundById(\"Travel1\").muted) {\n                //speak(\"Please select your action.\", {pitch: 150});\n                var responses = [\"Please select your action.\", \"What will you do now?\", \"What course will you follow now?\"];\n                speak(\"Welcome to \"+window.curPlanet.name+\". \"+responses[Math.floor(Math.random()*responses.length)], speakingOpts);\n            }\n            //alert(\"Boom\");\n        }});\n        //menuDiv.slideDown(2000);\n        $(\"body\").addClass(\"menuUp\");\n        window.scrollTo(0,1);\n        //canvg();\n    }\n    var fighting = false;\n    function fight(ships) {\n        window.scrollTo(0, 1);\n        document.body.ontouchstart = function(e) {\n            e.preventDefault();\n            return false;\n        };\n        \n        fighting = true;\n        soundManager.stopAll();\n        var n = Math.floor(Math.random()*(window.numBattleSongs))+1;\n        //console.log(n);\n        soundManager.play('Battle'+n);\n        \n        enemies = enemies.concat(ships);\n        //console.log(enemies);\n    }\n    function unfight() {\n        document.body.ontouchstart = undefined;\n        fighting = false;\n        soundManager.stopAll();\n        var n = Math.floor(Math.random()*(window.numTravelSongs))+1;\n        console.log(n);\n        soundManager.play('Travel'+n);\n        //soundManager.play('Travel');\n    }\n    function switchRing(num) {\n        if(num<=9) {\n            curRing = num;\n            for(var i=0;i<window.enemies.length;i++) {\n                window.enemies[i].maxHealth = window.enemies[i].baseHealth+((curRing-1)/(maxRings-1)*window.enemies[i].baseHealth);\n                window.enemies[i].health = window.enemies[i].maxHealth;\n                //this.maxHealth += ((curRing-1)/(maxRings-1));\n            }\n            //playerSpeedOrig = window.playerShip.spd;\n            window.playerShip.spd += ((curRing-1)/(maxRings-1)*window.playerShip.spd)/2;\n            document.title = \"Ring \"+curRing;\n        } else if(num>9){\n            window.curPlanet = magicPlanet;\n            Ticker.setPaused(true);\n            menuScreen();\n        }\n    }\n    \n    function travelTo(from, to) {\n        var sh = 128;\n        stage.mouseEnabled = false;\n        /*if(window.playerShip) {\n            var b = cloneBit(window.playerShip.bit);\n        }*/\n        window.enemies = [];\n        stage.removeAllChildren();\n        Ticker.setPaused(false);\n        var dist = Math.sqrt(Math.pow(from.x-to.x, 2)+Math.pow(from.y-to.y, 2));\n        //alert(dist);\n        from.bit.x = canvas[0].width/2-from.img.width*from.bit.scaleX/2;\n        from.bit.y = 0;\n        from.bit.width = from.img.width*from.bit.scaleX;\n        from.bit.height = from.img.height*from.bit.scaleY;\n        //console.log(from.bit);\n        stage.addChild(from.bit);\n        \n        to.bit.x = from.bit.x;\n        to.bit.y = -ship2plan*sh*dist+to.img.height/2;\n        to.bit.width = to.img.width*to.bit.scaleX;\n        to.bit.height = to.img.height*to.bit.scaleY;\n        stage.addChild(to.bit);\n        //console.log(to.bit);\n        //to.bit.y = 5*\n        stage.update();\n        window.from = from;\n        window.to = to;\n        soundManager.stopAll();\n        soundManager.play('Travel');\n        hideAll();\n        //otherMenu.show();\n        /*touchCons.show();\n        touchCons.css(\"display\", \"inline-block\");*/\n        if('ontouchstart' in window) {\n            touchCons.show();\n            touchCons.css(\"display\", \"inline-block\");\n            //alert(touchCons[0].style.display);\n        } else {\n            //otherMenu.show();\n        }\n        canvas.show();\n        canvas.attr(\"class\", \"space\");\n        $(\"body\").attr(\"class\", \"space\");\n        //canvas.css(\"background-position\", \"0px 0px\");\n        canvas[0].style.backgroundPositionX = \"0px\";\n        canvas[0].style.backgroundPositionY = \"0px\";\n        console.log(canvas[0].style.backgroundPosition);\n        //menuDiv.hide();\n        //splash.hide();\n        $(\"body\").removeClass(\"menuUp\");\n        //setInterval(function() {\n            //console.log(canvas[0]);\n            //console.log(canvas[0].style.backgroundPosition);\n            //canvas[0].style.backgroundPosition = new Number(canvas[0].style.backgroundPosition)-5+\"px\";\n            //canvas.css(\"background-position\", \"0px \"+parseInt(canvas[0].style.backgroundPositionY)+1+\"px\");\n            //*canvas[0].style.backgroundPositionY = parseInt(canvas[0].style.backgroundPositionY, 10)+20+\"px\";\n            //console.log(parseInt(canvas[0].style.backgroundPositionX, 10)+\"px -100px\");\n            //console.log(\"0px \"+parseInt(canvas[0].style.backgroundPositionY, 10)+\"px\");\n        //}, 1000/30);\n        //console.log(canvas.width);\n        //window.playerShip = window.playerShip||new PlayerShip(imgs.playerShip, canvas[0].width/2-shipW/2, canvas[0].height*0.75, shipW, shipW);\n        if(window.playerShip) {\n            window.playerShip = new PlayerShip(imgs.playerShip, canvas[0].width/2-shipW/2, canvas[0].height*0.75, shipW, shipW, window.playerShip.health, window.playerShip.maxHealth);\n        } else {\n            window.playerShip = new PlayerShip(imgs.playerShip, canvas[0].width/2-shipW/2, canvas[0].height*0.75, shipW, shipW);\n        }\n        //console.log(window.playerShip.bit);\n        /*if(b) {\n            window.playerShip.bit = b;\n            stage.addChild(b);\n        }*/\n        //stage.addChild(window.playerShip.bit);\n        stage.update();\n        //alert(canvas.width()/2-shipW/2);\n        unfight();\n        //fight([new EnemyShip(imgs.enemyShip, canvas[0].width/2-shipW/2, canvas[0].height*0.25-shipW, shipW, shipW)]);\n        //window.open(replacementImg(\"Graphics/starshipdark_flipped.svg\"));\n        Ticker.setFPS(30);\n        Ticker.addListener(window);\n    }\n    function splashScreen(callback) {\n        //soundManager.play(\"Levelup Sound\");\n        /*var s = soundManager.getSoundById(\"Levelup Sound\");\n        console.log(s);\n        s._onfinish = function() {\n            //alert(\"Ramalamlama Ice Ka dingity Ding de dong.\");\n            splash.fadeOut(500, callback);\n        };\n        s.play();*/\n        /*splash.fadeIn(3000, \"linear\", function() {\n            splash.fadeOut(500, \"linear\", callback);\n        });*/\n        //splash.css(\"display\", \"block\");\n        splash.show();\n        splash.css(\"opacity\", \"0\");\n        splash.animate({opacity: 1}, {duration: 1000, complete: function() {\n            splash.animate({opacity: 0}, {duration: 100, complete: callback});\n        }});\n        window.scrollTo(0, 1);\n    }\n    \n    window.init = function() {\n        hideAll();\n        $(\"#fly\").click(function() {\n            //travelTo(parseInt(prompt(\"How far away?\"), 10));\n            //travelTo(planets[0], planets[1]);\n            mapScreen();\n        });\n        var fsString = \"Do you want to go fullscreen? This is recommended.\";\n        /*if(document.body.webkitRequestFullScreen) {\n            //alert(\"Durr\");\n            if(confirm(fsString)) {\n                document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n            }\n        } else if(document.body.mozRequestFullScreen) {\n            if(confirm(fsString)) {\n                document.documentElement.mozRequestFullScreen();\n            }\n        } else {\n            alert(\"It is recommended that you go fullscreen. In most browsers, hit F11.\");\n        }\n        document.querySelector(\"#fs\").onclick = function() {\n            document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n        }*/\n        if(document.body.webkitRequestFullScreen) {\n            fsFunc = function() {\n                document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n            };\n        } else if(document.body.mozRequestFullScreen) {\n            fsFunc = function() {\n                document.documentElement.mozRequestFullScreen();\n            };\n        } else if(document.body.requestFullScreen) {\n            fsFunc = function() {\n                document.documentElement.requestFullScreen();\n            };\n        }\n        //console.log(fsFunc);\n        if(document.body.webkitRequestFullScreen || document.body.mozRequestFullScreen || document.body.requestFullScreen) {\n            document.getElementById(\"textFS\").innerHTML = fsString;\n            document.getElementById(\"enterFS\").onclick = function() {\n                //document.documentElement.webkitRequestFullScreen();\n                //console.log(fsFunc);\n                fsFunc();\n                document.getElementById(\"textFS\").innerHTML = \"You can exit fullscreen at any time by hitting F11\";\n                $(\"#enterFS, #cancelFS\").css(\"display\", \"none\");\n                setTimeout(function() {\n                    $(\"#fsBar\").animate({top: 0-$(\"#fsBar\").height()}, {duration: 1000, complete: function() {\n                        $(\"#fsBar\").css(\"display\", \"none\");\n                        $(\"#fsBar\").css(\"top\", \"0px\");\n                    }})\n                }, 3000);\n            };\n            //document.getElementById(\"enterFS\").onclick = document.documentElement.webkitRequestFullScreen;\n        } else {\n            document.getElementById(\"textFS\").innerHTML = \"Please enter fullscreen mode. In most browsers, this is done by pressing F11.\";\n            $(\"#enterFS, #cancelFS\").css(\"display\", \"none\");\n            setTimeout(function() {\n                $(\"#fsBar\").animate({top: 0-$(\"#fsBar\").height()}, {duration: 1000, complete: function() {\n                    $(\"#fsBar\").css(\"display\", \"none\");\n                    $(\"#fsBar\").css(\"top\", \"0px\");\n                }})\n            }, 3000);\n        }\n        \n        soundManager.url=\"Scripts/SoundManager2/swf/soundmanager2.swf\";\n        soundManager.defaultOptions.autoLoad = true;\n        soundManager.defaultOptions.autoPlay = false;\n        soundManager.onready(function() {\n            //console.log(\"SoundManager ready\");\n            window.numTravelSongs = 4;\n            soundManager.createSound({\n                id: 'Travel1',\n                url: './Sound/Music/Road Trip.mp3',\n                //url: \"http://wrathgames.com/blog/wp-content/plugins/download-monitor/download.php?id=74\",\n                volume: 50,\n                onfinish: function() {\n                    //console.log(this);\n                    this.play();\n                }\n            });\n            soundManager.createSound({\n                id: 'Travel2',\n                url: './Sound/Music/Max Loginov - Spacetraveller.mp3',\n                //url: \"http://wrathgames.com/blog/wp-content/plugins/download-monitor/download.php?id=74\",\n                volume: 50,\n                onfinish: function() {\n                    //console.log(this);\n                    this.play();\n                }\n            });\n            soundManager.createSound({\n                id: 'Travel3',\n                url: './Sound/Music/Sergey Borovkov - Phaeton.mp3',\n                volume: 50,\n                onfinish: function() {\n                    this.play();\n                }\n            });\n            soundManager.createSound({\n                id: 'Travel4',\n                url: './Sound/Music/Nicolas Millet - Aelig.mp3',\n                volume: 50,\n                onfinish: function() {\n                    this.play();\n                }\n            });\n            var battleVol = 75;\n            window.numBattleSongs = 4;\n            soundManager.createSound({\n                id: \"Battle1\",\n                volume: battleVol,\n                //url: \"./Sound/Music/Rusty Boss-man Tussle.mp3\",\n                //url: \"http://wrathgames.com/blog/resources/music/35/run_128.mp3\",\n                url: \"./Sound/Music/run_128.mp3\",\n                onfinish: function() {\n                    //console.log(this);\n                    this.play()\n                }\n            });\n            soundManager.createSound({\n                id: \"Battle2\",\n                volume: battleVol,\n                //url: \"./Sound/Music/Rusty Boss-man Tussle.mp3\",\n                //url: \"http://wrathgames.com/blog/resources/music/26/dragon_king_128.mp3\",\n                url: \"./Sound/Music/dragon_king_128.mp3\",\n                onfinish: function() {\n                    //console.log(this);\n                    this.play()\n                }\n            });\n            soundManager.createSound({\n                id: \"Battle3\",\n                volume: battleVol,\n                url: \"./Sound/Music/Rusty Boss-man Tussle.mp3\",\n                onfinish: function() {\n                    //console.log(this);\n                    this.play()\n                }\n            });\n            soundManager.createSound({\n                id: \"Battle4\",\n                volume: battleVol,\n                url: \"./Sound/Music/Xcentric Noizz - Trinity.mp3\",\n                onfinish: function() {\n                    this.play()\n                }\n            });\n            \n            soundManager.createSound({\n                id: 'Bullet',\n                url: './Sound/SFX/silencer.mp3',\n                //url: './Sound/Music/copycat_levelup.wav',\n                multiShot: true\n            });\n            soundManager.createSound({\n                id: \"Explosion\",\n                url: \"http://wrathgames.com/blog/resources/sound/1/explosion1.mp3\",\n            });\n            /*soundManager.createSound({\n                id: 'Levelup Sound',\n                url: \"./Sound/Music/copycat_levelup.wav\",\n                autoLoad: true\n            });*/\n            //soundManager.play('Battle');\n            splashScreen(menuScreen);\n        });\n        soundManager.ontimeout(function(status) {\n            console.log(\"SM2 Error\", status);\n            window.soundManager = {\n                play: function() {},\n                stopAll: function(){},\n                getSoundById: function() {\n                    return {muted: false};\n                }\n            };\n            splashScreen(menuScreen);\n        });\n        $(\"#audioToggle\").click(function() {\n            //soundManager.toggleMute();\n            if(soundManager.getSoundById(\"Travel1\").muted) {\n                soundManager.unmute();\n                $(\"#audioToggle img\").attr(\"src\", imgs.speaker);\n            } else {\n                soundManager.mute();\n                $(\"#audioToggle img\").attr(\"src\", imgs.muted);\n            }\n        });\n            $(\"#pauseToggle\").click(function() {\n                /*var p = Ticker.getPaused();\n                Ticker.setPaused(!p);\n                if(p) {\n                    window.enemTimeout = setTimeout(function() { fight([new EnemyShip(imgs.enemyShip, canvas[0].width/2-shipW/2, canvas[0].height*0.25-shipW, shipW, shipW)])}, 45000);\n                    $(\"#pauseToggle img\").attr(\"src\", imgs.pause);\n                } else {\n                    clearTimeout(window.enemTimeout);\n                    $(\"#pauseToggle img\").attr(\"src\", imgs.play);\n                }*/\n                pausePlay()\n            });\n        //splashScreen(menuScreen);\n        //menuScreen();\n        //travelTo(5000);\n        //splashScreen(menuScreen);\n    }\n    /*if(!Modernizr.svg || three) {\n        console.log(imgs, imgs.stars);\n        canvas.css(\"background-image\", \"url(\"+imgs.stars+\")\");\n    }*/\n    soundManager.debugMode = false;\n    //soundManager.useHighPerformance = true;\n    hideAll();\n    init();\n    \n    var currentWidth;\n    var updateLayout = function() {\n        //alert(\"Update time!\");\n        if (window.innerWidth != currentWidth) {\n            currentWidth = window.innerWidth;\n            var orient = (currentWidth == 320) ? \"portrait\" : \"landscape\";\n            document.body.setAttribute(\"orient\", orient);\n            touchCons.attr(\"class\", orient);\n            //window.scrollTo(0, 1);\n            //alert(orient);\n        }\n    };\n    if('ontouchstart' in window) {\n        setInterval(updateLayout, 250);\n    }\n    //socketStart();\n};"]],"start1":0,"start2":0,"length1":0,"length2":38577}]],"length":38577}
